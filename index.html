<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Style Hub ¬∑ Complete E-commerce Platform</title>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  
  <style>
    /* ==================== GLOBAL STYLES ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Noto Sans Bengali', sans-serif;
      background: #f8fafc;
      color: #1e293b;
      line-height: 1.5;
      transition: background-color 0.3s, color 0.3s;
    }

    /* Dark Mode */
    body.dark-mode {
      background: #0f172a;
      color: #f1f5f9;
    }

    body.dark-mode .header,
    body.dark-mode .product-card,
    body.dark-mode .filters-sidebar,
    body.dark-mode .products-section,
    body.dark-mode .modal-content,
    body.dark-mode .payment-modal-content {
      background: #1e293b;
      border-color: #334155;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --dark: #1e293b;
      --light: #f8fafc;
      --gray: #64748b;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* ==================== LANGUAGE SWITCHER ==================== */
    .lang-switcher {
      display: flex;
      gap: 8px;
      margin-right: 15px;
    }

    .lang-btn {
      padding: 6px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      background: transparent;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .lang-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary);
    }

    .lang-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* ==================== HEADER ==================== */
    .header {
      background: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 15px 0;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 15px;
    }

    .logo {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Search */
    .search-container {
      flex: 1;
      max-width: 400px;
      position: relative;
    }

    .search-box {
      width: 100%;
      padding: 12px 20px;
      border: 1px solid #e2e8f0;
      border-radius: 40px;
      font-family: 'Inter', sans-serif;
    }

    .search-box:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
    }

    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-top: 5px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
    }

    .suggestions.active {
      display: block;
    }

    /* Navigation */
    .nav-menu {
      display: flex;
      gap: 30px;
    }

    .nav-link {
      text-decoration: none;
      color: var(--dark);
      font-weight: 500;
    }

    /* User Menu */
    .user-menu {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .icon-btn {
      position: relative;
      font-size: 1.3rem;
      cursor: pointer;
      background: none;
      border: none;
      color: var(--dark);
    }

    .badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--secondary);
      color: white;
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 20px;
    }

    /* Buttons */
    .btn {
      padding: 10px 24px;
      border-radius: 40px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Inter', sans-serif;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid #e2e8f0;
    }

    /* ==================== PRODUCT CARD WITH SLIDER ==================== */
    .main-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 30px;
      margin: 30px 0;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 25px;
    }

    .product-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      overflow: hidden;
      transition: 0.3s;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }

    /* Image Slider */
    .product-slider {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      overflow: hidden;
    }

    .slider-container {
      width: 100%;
      height: 100%;
      display: flex;
      transition: transform 0.3s ease;
    }

    .slider-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      flex-shrink: 0;
    }

    .slider-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 30px;
      height: 30px;
      background: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      opacity: 0;
      transition: 0.2s;
    }

    .product-card:hover .slider-btn {
      opacity: 1;
    }

    .slider-btn.left { left: 10px; }
    .slider-btn.right { right: 10px; }

    .thumbnail-container {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 5px;
      background: rgba(255,255,255,0.9);
      padding: 5px 10px;
      border-radius: 20px;
      opacity: 0;
      transition: 0.2s;
    }

    .product-card:hover .thumbnail-container {
      opacity: 1;
    }

    .thumbnail {
      width: 30px;
      height: 30px;
      border-radius: 5px;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .thumbnail.active {
      border-color: var(--primary);
    }

    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 3px;
    }

    .product-info {
      padding: 20px;
    }

    .product-name {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .product-price {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
      margin: 10px 0;
    }

    .size-options {
      display: flex;
      gap: 5px;
      margin: 10px 0;
    }

    .size-btn {
      width: 35px;
      height: 35px;
      border: 1px solid #e2e8f0;
      background: white;
      border-radius: 5px;
      cursor: pointer;
    }

    .size-btn.active {
      background: var(--primary);
      color: white;
    }

    .color-options {
      display: flex;
      gap: 5px;
      margin: 10px 0;
    }

    .color-dot {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .color-dot.active {
      border-color: var(--primary);
      transform: scale(1.2);
    }

    .btn-add-cart {
      width: 100%;
      padding: 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      margin-top: 10px;
    }

    /* ==================== PAYMENT MODAL ==================== */
    .payment-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .payment-modal.active {
      display: flex;
    }

    .payment-modal-content {
      background: white;
      border-radius: 24px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .payment-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
    }

    .payment-methods {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 20px;
    }

    .payment-method {
      padding: 15px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
    }

    .payment-method.selected {
      border-color: var(--primary);
      background: #eff6ff;
    }

    .payment-form {
      padding: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
    }

    /* ==================== MODALS ==================== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1500;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 24px;
      width: 90%;
      max-width: 500px;
    }

    .close-modal {
      float: right;
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--dark);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      z-index: 3000;
      display: none;
    }

    @media (max-width: 768px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      .nav-menu {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-content">
      <div class="logo">STYLE HUB</div>

      <!-- Language Switcher -->
      <div class="lang-switcher">
        <button class="lang-btn active" data-lang="en" onclick="changeLanguage('en')">EN</button>
        <button class="lang-btn" data-lang="bn" onclick="changeLanguage('bn')">‡¶¨‡¶æ‡¶Ç</button>
        <button class="lang-btn" data-lang="hi" onclick="changeLanguage('hi')">‡§π‡§ø</button>
      </div>

      <!-- Search -->
      <div class="search-container">
        <input type="text" class="search-box" id="search-input" placeholder="Search products...">
        <div class="suggestions" id="suggestions"></div>
      </div>

      <!-- User Menu -->
      <div class="user-menu">
        <button class="icon-btn" onclick="toggleTheme()">
          <i class="fas fa-moon"></i>
        </button>
        <button class="icon-btn" onclick="showWishlist()">
          <i class="far fa-heart"></i>
          <span class="badge" id="wishlist-count">0</span>
        </button>
        <button class="icon-btn" onclick="showCart()">
          <i class="fas fa-shopping-bag"></i>
          <span class="badge" id="cart-count">0</span>
        </button>
        <div class="auth-buttons" id="auth-buttons">
          <button class="btn btn-outline" onclick="showModal('auth-modal', 'login')" data-key="login">Login</button>
          <button class="btn btn-primary" onclick="showModal('auth-modal', 'register')" data-key="register">Register</button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- Main Layout -->
    <div class="main-layout">
      <!-- Filters -->
      <aside class="filters-sidebar">
        <h3 data-key="filters">Filters</h3>
        <div class="filter-section">
          <h4 data-key="categories">Categories</h4>
          <div id="category-filters"></div>
        </div>
        <div class="filter-section">
          <h4 data-key="price">Price Range</h4>
          <input type="range" min="0" max="1000" value="500" onchange="applyFilters()">
        </div>
      </aside>

      <!-- Products -->
      <section class="products-section">
        <div class="products-header">
          <h2 data-key="products">Products</h2>
          <span id="product-count">70 products</span>
        </div>
        <div class="product-grid" id="product-grid"></div>
      </section>
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="payment-modal" id="payment-modal">
    <div class="payment-modal-content" id="payment-content">
      <!-- Dynamic payment content -->
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="auth-modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('auth-modal')">&times;</span>
      <h2 id="auth-title">Login</h2>
      <form onsubmit="handleAuth(event)">
        <input type="text" id="auth-name" placeholder="Full Name" style="display: none;">
        <input type="email" id="auth-email" placeholder="Email" required>
        <input type="password" id="auth-password" placeholder="Password" required>
        <button type="submit" class="btn btn-primary" style="width:100%; margin-top:15px;">Continue</button>
      </form>
    </div>
  </div>

  <!-- Cart Modal -->
  <div class="modal" id="cart-modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('cart-modal')">&times;</span>
      <h3 data-key="cart">Shopping Cart</h3>
      <div id="cart-items"></div>
      <div class="cart-total" id="cart-total">Total: $0.00</div>
      <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="proceedToPayment()" data-key="checkout">Checkout</button>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // ==================== FIREBASE CONFIG ====================
    const firebaseConfig = {
      apiKey: "AIzaSyDxOMNduC5AU5AaHmga2yC_V3RHjhX2ykQ",
      authDomain: "style-hub-fe257.firebaseapp.com",
      projectId: "style-hub-fe257",
      storageBucket: "style-hub-fe257.firebasestorage.app",
      messagingSenderId: "544518937543",
      appId: "1:544518937543:web:74dbc18a88b1f1d16f97e2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ==================== LANGUAGE TRANSLATIONS ====================
    const translations = {
      en: {
        login: 'Login',
        register: 'Register',
        logout: 'Logout',
        filters: 'Filters',
        categories: 'Categories',
        price: 'Price Range',
        products: 'Products',
        cart: 'Shopping Cart',
        checkout: 'Checkout',
        'add-to-cart': 'Add to Cart',
        'wishlist': 'Wishlist',
        'compare': 'Compare',
        'search': 'Search products...'
      },
      bn: {
        login: '‡¶≤‡¶ó‡¶á‡¶®',
        register: '‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞',
        logout: '‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü',
        filters: '‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞',
        categories: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø',
        price: '‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶∏‡ßÄ‡¶Æ‡¶æ',
        products: '‡¶™‡¶£‡ßç‡¶Ø',
        cart: '‡¶∂‡¶™‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü',
        checkout: '‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü',
        'add-to-cart': '‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®',
        'wishlist': '‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ',
        'compare': '‡¶§‡ßÅ‡¶≤‡¶®‡¶æ',
        'search': '‡¶™‡¶£‡ßç‡¶Ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...'
      },
      hi: {
        login: '‡§≤‡•â‡§ó‡§ø‡§®',
        register: '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞',
        logout: '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü',
        filters: '‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞',
        categories: '‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Å',
        price: '‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§∏‡•Ä‡§Æ‡§æ',
        products: '‡§â‡§§‡•ç‡§™‡§æ‡§¶',
        cart: '‡§ï‡§æ‡§∞‡•ç‡§ü',
        checkout: '‡§ö‡•á‡§ï‡§Ü‡§â‡§ü',
        'add-to-cart': '‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        'wishlist': '‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ',
        'compare': '‡§§‡•Å‡§≤‡§®‡§æ',
        'search': '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ñ‡•ã‡§ú‡•á‡§Ç...'
      }
    };

    // ==================== LANGUAGE FUNCTION ====================
    function changeLanguage(lang) {
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.getAttribute('data-key');
        if (translations[lang] && translations[lang][key]) {
          if (el.tagName === 'INPUT' && el.placeholder) {
            el.placeholder = translations[lang][key];
          } else {
            el.textContent = translations[lang][key];
          }
        }
      });

      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.placeholder = translations[lang].search;
      }
    }

    // ==================== PRODUCTS WITH MULTIPLE IMAGES ====================
    const products = [
      {
        id: 1,
        name: 'Classic Oxford Shirt',
        price: 49.99,
        category: 'Shirts',
        images: [
          'https://images.unsplash.com/photo-1598033129075-9c5f7c7f3c7a?w=400',
          'https://images.unsplash.com/photo-1603252109303-2751441dd157?w=400',
          'https://images.unsplash.com/photo-1598032895397-b9472444bf93?w=400'
        ],
        sizes: ['S', 'M', 'L', 'XL'],
        colors: ['White', 'Blue', 'Black'],
        stock: 45,
        rating: 4.5
      },
      {
        id: 2,
        name: 'Running Sneakers',
        price: 89.99,
        category: 'Footwear',
        images: [
          'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400',
          'https://images.unsplash.com/photo-1525966222134-fcfa99b8ae77?w=400',
          'https://images.unsplash.com/photo-1608256246200-53e635b7089d?w=400'
        ],
        sizes: ['7', '8', '9', '10', '11'],
        colors: ['White', 'Black', 'Blue'],
        stock: 52,
        rating: 4.7
      },
      {
        id: 3,
        name: 'Leather Watch',
        price: 149.99,
        category: 'Watches',
        images: [
          'https://images.unsplash.com/photo-1524805444758-089113d48a6d?w=400',
          'https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?w=400',
          'https://images.unsplash.com/photo-1539874754764-5a96559165b0?w=400'
        ],
        sizes: ['One Size'],
        colors: ['Brown', 'Black'],
        stock: 25,
        rating: 4.8
      }
    ];

    // Generate 70 products
    for (let i = 4; i <= 70; i++) {
      const base = products[i % 3];
      products.push({
        id: i,
        name: `${base.name} ${i}`,
        price: base.price + (i % 20),
        category: base.category,
        images: base.images,
        sizes: base.sizes,
        colors: base.colors,
        stock: 20 + (i % 50),
        rating: 3.5 + (i % 15) / 10
      });
    }

    // ==================== GLOBAL VARIABLES ====================
    let currentUser = null;
    let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let currentSlide = {};
    let selectedSizes = {};
    let selectedColors = {};

    // ==================== DISPLAY PRODUCTS WITH SLIDER ====================
    function displayProducts() {
      const grid = document.getElementById('product-grid');
      
      grid.innerHTML = products.map(p => {
        const slides = p.images.map((img, idx) => `
          <img src="${img}" alt="${p.name}" data-index="${idx}">
        `).join('');

        const thumbnails = p.images.map((img, idx) => `
          <div class="thumbnail ${idx === 0 ? 'active' : ''}" onclick="setSlide(${p.id}, ${idx})">
            <img src="${img}" alt="thumb">
          </div>
        `).join('');

        const wishlisted = wishlist.includes(p.id) ? 'fas' : 'far';

        return `
        <div class="product-card" data-id="${p.id}">
          <div class="product-slider" id="slider-${p.id}">
            <div class="slider-container" id="slider-container-${p.id}" style="transform: translateX(0px);">
              ${slides}
            </div>
            <button class="slider-btn left" onclick="slide(${p.id}, -1)">‚ùÆ</button>
            <button class="slider-btn right" onclick="slide(${p.id}, 1)">‚ùØ</button>
            <div class="thumbnail-container">
              ${thumbnails}
            </div>
          </div>
          <div class="product-info">
            <div class="product-name">${p.name}</div>
            <div class="product-price">$${p.price}</div>
            
            <div class="size-options">
              ${p.sizes.map(s => `
                <button class="size-btn" onclick="selectSize(${p.id}, '${s}')">${s}</button>
              `).join('')}
            </div>
            
            <div class="color-options">
              ${p.colors.map(c => `
                <span class="color-dot" style="background: ${c.toLowerCase()};" 
                      onclick="selectColor(${p.id}, '${c}')"></span>
              `).join('')}
            </div>
            
            <button class="btn-add-cart" onclick="addToCart(${p.id})">
              <i class="fas fa-cart-plus"></i> Add to Cart
            </button>
          </div>
        </div>
      `}).join('');

      updateCounts();
    }

    // Slider Functions
    window.slide = function(productId, direction) {
      const container = document.getElementById(`slider-container-${productId}`);
      const currentTransform = container.style.transform;
      const currentX = currentTransform ? parseInt(currentTransform.split('(')[1]) : 0;
      const newX = currentX - (direction * 100);
      const maxX = -((products.find(p => p.id === productId).images.length - 1) * 100);
      
      if (newX <= 0 && newX >= maxX) {
        container.style.transform = `translateX(${newX}%)`;
        updateActiveThumbnail(productId, Math.abs(newX / 100));
      }
    };

    window.setSlide = function(productId, index) {
      const container = document.getElementById(`slider-container-${productId}`);
      container.style.transform = `translateX(-${index * 100}%)`;
      updateActiveThumbnail(productId, index);
    };

    function updateActiveThumbnail(productId, activeIndex) {
      const thumbnails = document.querySelectorAll(`#slider-${productId} .thumbnail`);
      thumbnails.forEach((t, i) => {
        t.classList.toggle('active', i === activeIndex);
      });
    }

    // Size/Color Selection
    window.selectSize = function(productId, size) {
      selectedSizes[productId] = size;
      document.querySelectorAll(`[data-id="${productId}"] .size-btn`).forEach(btn => {
        btn.classList.toggle('active', btn.textContent === size);
      });
    };

    window.selectColor = function(productId, color) {
      selectedColors[productId] = color;
      document.querySelectorAll(`[data-id="${productId}"] .color-dot`).forEach(dot => {
        dot.classList.toggle('active', dot.style.backgroundColor === color.toLowerCase());
      });
    };

    // ==================== CART FUNCTIONS ====================
    window.addToCart = function(productId) {
      if (!currentUser) {
        showToast('Please login first');
        return;
      }

      const product = products.find(p => p.id === productId);
      const size = selectedSizes[productId] || product.sizes[0];
      const color = selectedColors[productId] || product.colors[0];

      const cartItem = cart.find(item => 
        item.id === productId && item.size === size && item.color === color
      );

      if (cartItem) {
        if (cartItem.quantity < product.stock) {
          cartItem.quantity++;
        } else {
          showToast('Out of stock');
          return;
        }
      } else {
        cart.push({ ...product, quantity: 1, size, color });
      }

      updateCart();
      showToast('Added to cart!');
    };

    function updateCart() {
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cart-count').textContent = count;
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    window.showCart = function() {
      const modal = document.getElementById('cart-modal');
      const itemsDiv = document.getElementById('cart-items');
      const totalDiv = document.getElementById('cart-total');

      if (cart.length === 0) {
        itemsDiv.innerHTML = '<p style="text-align:center; color:var(--gray);">Cart is empty</p>';
        totalDiv.textContent = 'Total: $0.00';
      } else {
        itemsDiv.innerHTML = cart.map(item => `
          <div style="display:flex; gap:15px; margin-bottom:15px; padding-bottom:15px; border-bottom:1px solid #e2e8f0;">
            <img src="${item.images[0]}" style="width:60px; height:60px; object-fit:cover; border-radius:8px;">
            <div style="flex:1;">
              <div style="font-weight:600;">${item.name}</div>
              <div style="font-size:0.9rem; color:var(--gray);">${item.size} | ${item.color}</div>
              <div>$${item.price} x ${item.quantity}</div>
            </div>
            <div>
              <div style="font-weight:600;">$${(item.price * item.quantity).toFixed(2)}</div>
              <button onclick="removeFromCart('${item.id}_${item.size}_${item.color}')" style="color:var(--danger); background:none; border:none; cursor:pointer;">Remove</button>
            </div>
          </div>
        `).join('');

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        totalDiv.textContent = `Total: $${total.toFixed(2)}`;
      }

      modal.classList.add('active');
    };

    window.removeFromCart = function(itemKey) {
      const [id, size, color] = itemKey.split('_');
      cart = cart.filter(item => !(item.id == id && item.size === size && item.color === color));
      updateCart();
      showCart();
    };

    // ==================== PAYMENT SYSTEM ====================
    window.proceedToPayment = function() {
      closeModal('cart-modal');
      const modal = document.getElementById('payment-modal');
      const content = document.getElementById('payment-content');
      
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const shipping = subtotal > 100 ? 0 : 10;
      const total = subtotal + shipping;

      content.innerHTML = `
        <div class="payment-header">
          <h3>Complete Payment</h3>
          <span class="close-modal" onclick="closePaymentModal()">&times;</span>
        </div>
        
        <div style="padding:20px;">
          <div style="background:#f8fafc; padding:20px; border-radius:12px; margin-bottom:20px;">
            <h4>Order Summary</h4>
            <div style="display:flex; justify-content:space-between; margin:10px 0;">
              <span>Subtotal</span>
              <span>$${subtotal.toFixed(2)}</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin:10px 0;">
              <span>Shipping</span>
              <span>${shipping === 0 ? 'Free' : '$' + shipping}</span>
            </div>
            <div style="display:flex; justify-content:space-between; font-weight:700; margin-top:15px; padding-top:15px; border-top:2px dashed #e2e8f0;">
              <span>Total</span>
              <span>$${total.toFixed(2)}</span>
            </div>
          </div>

          <h4 style="margin-bottom:15px;">Select Payment Method</h4>
          <div class="payment-methods">
            <div class="payment-method" onclick="selectPaymentMethod('bkash')">
              <i class="fas fa-mobile-alt" style="color:#E2136E; font-size:2rem;"></i>
              <div>bKash</div>
            </div>
            <div class="payment-method" onclick="selectPaymentMethod('nagad')">
              <i class="fas fa-mobile-alt" style="color:#F5821F; font-size:2rem;"></i>
              <div>Nagad</div>
            </div>
            <div class="payment-method" onclick="selectPaymentMethod('rocket')">
              <i class="fas fa-mobile-alt" style="color:#662D91; font-size:2rem;"></i>
              <div>Rocket</div>
            </div>
            <div class="payment-method" onclick="selectPaymentMethod('card')">
              <i class="fas fa-credit-card" style="color:#2563EB; font-size:2rem;"></i>
              <div>Card</div>
            </div>
          </div>

          <div id="payment-form" class="payment-form">
            <!-- Dynamic form -->
          </div>

          <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="processPayment()">Pay Now</button>
        </div>
      `;

      modal.classList.add('active');
    };

    window.selectPaymentMethod = function(method) {
      document.querySelectorAll('.payment-method').forEach(el => {
        el.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');

      const formDiv = document.getElementById('payment-form');
      
      if (method === 'bkash' || method === 'nagad' || method === 'rocket') {
        formDiv.innerHTML = `
          <div class="form-group">
            <label>Mobile Number</label>
            <input type="tel" id="mobile" placeholder="01XXXXXXXXX">
          </div>
          <div class="form-group">
            <label>Transaction ID</label>
            <input type="text" id="trxid" placeholder="Enter transaction ID">
          </div>
          <div style="background:#f1f5f9; padding:15px; border-radius:8px; margin:15px 0;">
            <p>Send money to 019XXXXXXXX and enter transaction ID above</p>
          </div>
        `;
      } else {
        formDiv.innerHTML = `
          <div class="form-group">
            <label>Card Number</label>
            <input type="text" id="card" placeholder="1234 5678 9012 3456">
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div class="form-group">
              <label>Expiry</label>
              <input type="text" id="expiry" placeholder="MM/YY">
            </div>
            <div class="form-group">
              <label>CVV</label>
              <input type="text" id="cvv" placeholder="123">
            </div>
          </div>
          <div class="form-group">
            <label>Card Holder</label>
            <input type="text" id="name" placeholder="Name on card">
          </div>
        `;
      }
    };

    window.processPayment = function() {
      showToast('Processing payment...');
      
      setTimeout(() => {
        showToast('Payment successful! üéâ');
        cart = [];
        updateCart();
        closePaymentModal();
        closeModal('cart-modal');
      }, 2000);
    };

    function closePaymentModal() {
      document.getElementById('payment-modal').classList.remove('active');
    }

    // ==================== WISHLIST ====================
    window.toggleWishlist = function(productId) {
      const index = wishlist.indexOf(productId);
      if (index === -1) {
        wishlist.push(productId);
      } else {
        wishlist.splice(index, 1);
      }
      localStorage.setItem('wishlist', JSON.stringify(wishlist));
      updateCounts();
      displayProducts(); // Refresh to update heart icons
    };

    window.showWishlist = function() {
      if (wishlist.length === 0) {
        showToast('Wishlist is empty');
        return;
      }

      const wishlistProducts = products.filter(p => wishlist.includes(p.id));
      const html = wishlistProducts.map(p => `
        <div style="text-align:center; padding:15px; background:#f8fafc; border-radius:12px;">
          <img src="${p.images[0]}" style="width:100%; height:100px; object-fit:cover; border-radius:8px;">
          <div style="font-weight:600; margin:10px 0;">${p.name}</div>
          <div>$${p.price}</div>
        </div>
      `).join('');

      const modal = document.createElement('div');
      modal.className = 'modal active';
      modal.innerHTML = `
        <div class="modal-content">
          <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
          <h3>Wishlist</h3>
          <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:15px; margin-top:20px;">
            ${html}
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    };

    // ==================== AUTH ====================
    auth.onAuthStateChanged(user => {
      if (user) {
        db.collection('users').doc(user.uid).get().then(doc => {
          if (doc.exists) {
            currentUser = { uid: user.uid, ...doc.data() };
          } else {
            currentUser = { uid: user.uid, email: user.email, name: user.email.split('@')[0] };
          }
          updateAuthUI();
          showToast(`Welcome, ${currentUser.name}!`);
        });
      } else {
        currentUser = null;
        updateAuthUI();
      }
    });

    function updateAuthUI() {
      const authDiv = document.getElementById('auth-buttons');
      if (currentUser) {
        authDiv.innerHTML = `
          <span>${currentUser.name}</span>
          <button class="btn btn-outline" onclick="logout()">Logout</button>
        `;
      } else {
        authDiv.innerHTML = `
          <button class="btn btn-outline" onclick="showModal('auth-modal', 'login')">Login</button>
          <button class="btn btn-primary" onclick="showModal('auth-modal', 'register')">Register</button>
        `;
      }
    }

    window.showModal = function(modalId, type) {
      if (modalId === 'auth-modal') {
        document.getElementById('auth-title').textContent = type === 'login' ? 'Login' : 'Create Account';
        document.getElementById('auth-name').style.display = type === 'register' ? 'block' : 'none';
      }
      document.getElementById(modalId).classList.add('active');
    };

    window.closeModal = function(modalId) {
      document.getElementById(modalId).classList.remove('active');
    };

    window.handleAuth = async function(e) {
      e.preventDefault();
      const email = document.getElementById('auth-email').value;
      const password = document.getElementById('auth-password').value;
      const name = document.getElementById('auth-name').value;
      const title = document.getElementById('auth-title').textContent;

      try {
        if (title === 'Create Account') {
          const userCred = await auth.createUserWithEmailAndPassword(email, password);
          await db.collection('users').doc(userCred.user.uid).set({
            name: name || email.split('@')[0],
            email: email,
            createdAt: new Date().toISOString()
          });
        } else {
          await auth.signInWithEmailAndPassword(email, password);
        }
        closeModal('auth-modal');
      } catch (error) {
        showToast(error.message);
      }
    };

    window.logout = function() {
      auth.signOut();
    };

    // ==================== THEME ====================
    window.toggleTheme = function() {
      document.body.classList.toggle('dark-mode');
      const icon = document.querySelector('.theme-toggle i');
      icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
    };

    // ==================== UTILS ====================
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 3000);
    }

    function updateCounts() {
      document.getElementById('wishlist-count').textContent = wishlist.length;
      updateCart();
    }

    // ==================== INIT ====================
    displayProducts();
    changeLanguage('en');
  </script>
</body>
</html>
